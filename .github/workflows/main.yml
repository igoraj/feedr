name: Monitor EMA and Update RSS

on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

  # Runs on pushes to the main branch
  push:
    branches:
      - main
      - master

  schedule:
    # Runs every hour during work weeks (Mon-Fri) between 7 AM and 4 PM UTC
    - cron: '0 7-16 * * 1-5'

jobs:
  build-and-commit:
    runs-on: ubuntu-latest

    # Grant write permission to the job to allow committing back to the repo
    permissions:
      contents: write

    steps:
      - name: Check out repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Using a common, stable version
          cache: 'pip' # Caches dependencies to speed up future runs

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run the monitor script
        run: python3 main.py

      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automated: Update RSS feed and state"
          # The action will only commit if these files have changed
          file_pattern: ema_updates.xml ema_monitor_state.json
          
          # Optional: Use a specific author for the commit
          commit_user_name: GitHub Actions Bot
          commit_user_email: actions@github.com
